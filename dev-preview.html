<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EzTax 개발 미리보기</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header { 
            background: #2563eb; 
            color: white; 
            padding: 20px; 
            text-align: center; 
        }
        .status { 
            background: #10b981; 
            color: white; 
            padding: 10px 20px; 
            margin: 20px; 
            border-radius: 5px; 
        }
        .section { 
            padding: 20px; 
            border-bottom: 1px solid #e5e5e5; 
        }
        .api-test { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
        }
        .btn { 
            background: #2563eb; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        .btn:hover { background: #1d4ed8; }
        .result { 
            background: #f1f5f9; 
            padding: 10px; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-family: monospace; 
            white-space: pre-wrap; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧾 EzTax - 세금 신고 시스템</h1>
            <p>개발 환경 테스트 인터페이스</p>
        </div>

        <div class="status">
            ✅ 서버 상태: 정상 실행 중 (포트 5000)
        </div>

        <div class="section">
            <h2>📊 애플리케이션 기능 테스트</h2>
            
            <div class="api-test">
                <h3>세금 신고서 데이터 조회</h3>
                <button class="btn" onclick="testAPI('/api/tax-return')">현재 세금 신고서 불러오기</button>
                <div id="tax-return-result" class="result"></div>
            </div>

            <div class="api-test">
                <h3>사용자 인증 상태</h3>
                <button class="btn" onclick="testAPI('/api/user')">사용자 정보 확인</button>
                <div id="user-result" class="result"></div>
            </div>

            <div class="api-test">
                <h3>새 세금 신고서 생성</h3>
                <button class="btn" onclick="createTaxReturn()">새 신고서 생성</button>
                <div id="create-result" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2>🎯 주요 기능 상태</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 개인정보 입력</h4>
                    <p>이름, 주소, SSN 등 기본정보 저장</p>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 소득 계산</h4>
                    <p>급여, 이자, 배당금 등 소득 계산</p>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 공제 처리</h4>
                    <p>표준/항목별 공제, SALT 공제 포함</p>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 세액공제</h4>
                    <p>자녀세액공제, 교육세액공제 등</p>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 최종 계산</h4>
                    <p>환급액/납부액 자동 계산</p>
                </div>
                <div style="background: #ecfdf5; padding: 15px; border-radius: 5px;">
                    <h4>✅ 데이터 저장</h4>
                    <p>PostgreSQL 데이터베이스 연동</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>🔧 개발 도구</h2>
            <button class="btn" onclick="window.open('https://3e18f96e-0fbf-4af6-b766-cfbae9f2437b-00-17nnd6cbvtwuy.janeway.replit.dev/', '_blank')">
                🌐 외부 URL로 접근 시도
            </button>
            <button class="btn" onclick="location.reload()">🔄 페이지 새로고침</button>
            <button class="btn" onclick="showFileStructure()">📁 프로젝트 구조 보기</button>
        </div>

        <div class="section">
            <h2>📝 수정 가능한 주요 파일들</h2>
            <ul>
                <li><strong>client/src/pages/</strong> - 각 단계별 페이지 컴포넌트</li>
                <li><strong>client/src/context/TaxContext.tsx</strong> - 세금 계산 로직</li>
                <li><strong>server/routes.ts</strong> - API 엔드포인트</li>
                <li><strong>shared/schema.ts</strong> - 데이터 스키마 정의</li>
            </ul>
        </div>
    </div>

    <script>
        async function testAPI(endpoint) {
            const resultId = endpoint.replace('/api/', '') + '-result';
            const resultDiv = document.getElementById(resultId);
            
            try {
                resultDiv.textContent = '로딩 중...';
                
                // Try multiple connection methods
                const urls = [
                    `http://localhost:5000${endpoint}`,
                    `https://3e18f96e-0fbf-4af6-b766-cfbae9f2437b-00-17nnd6cbvtwuy.janeway.replit.dev${endpoint}`,
                    `http://127.0.0.1:5000${endpoint}`
                ];
                
                let lastError;
                for (const url of urls) {
                    try {
                        const response = await fetch(url, {
                            mode: 'cors',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        const data = await response.json();
                        resultDiv.textContent = `연결 성공: ${url}\n상태: ${response.status}\n\n` + JSON.stringify(data, null, 2);
                        return;
                    } catch (error) {
                        lastError = error;
                        continue;
                    }
                }
                throw lastError;
            } catch (error) {
                resultDiv.textContent = `연결 실패: ${error.message}\n\n서버 상태를 확인하거나 다음 URL로 직접 접근해보세요:\n- http://localhost:5000\n- https://3e18f96e-0fbf-4af6-b766-cfbae9f2437b-00-17nnd6cbvtwuy.janeway.replit.dev`;
            }
        }

        async function createTaxReturn() {
            const resultDiv = document.getElementById('create-result');
            
            try {
                resultDiv.textContent = '새 세금 신고서 생성 중...';
                const response = await fetch('http://localhost:5000/api/tax-return', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: 1,
                        taxYear: 2025,
                        status: 'in_progress',
                        personalInfo: {
                            firstName: '테스트',
                            lastName: '사용자',
                            filingStatus: 'single',
                            dependents: []
                        }
                    })
                });
                const data = await response.json();
                resultDiv.textContent = `상태: ${response.status}\n생성된 ID: ${data.id}\n\n` + JSON.stringify(data, null, 2);
            } catch (error) {
                resultDiv.textContent = `오류: ${error.message}`;
            }
        }

        function showFileStructure() {
            alert(`EzTax 프로젝트 구조:

📁 client/
  📁 src/
    📁 pages/ - 세금 신고 단계별 페이지
    📁 components/ - 재사용 컴포넌트
    📁 context/ - 전역 상태 관리
    📁 hooks/ - 커스텀 훅

📁 server/
  📄 routes.ts - API 라우트
  📄 auth.ts - 인증 시스템
  📄 storage.ts - 데이터 저장

📁 shared/
  📄 schema.ts - 데이터 스키마`);
        }

        // 페이지 로드 시 기본 테스트 실행
        window.onload = function() {
            testAPI('/api/tax-return');
        };
    </script>
</body>
</html>